Write a Row Level Before and After Trigger on Library table. The
System should keep track of the records that are being updated or
deleted. The old value of updated or deleted records should be
added in Library_Audit table.



CREATE TABLE Library (
  id NUMBER PRIMARY KEY,
  book_name VARCHAR2(100),
  status VARCHAR2(50) 
);

CREATE TABLE Library_Audit (
  audit_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  id_old NUMBER,
  book_name_old VARCHAR2(100),
  status_old VARCHAR2(50),
  operation_type VARCHAR2(10), 
  operation_date DATE
);

INSERT INTO Library VALUES (101, 'Database Systems', 'Available');
INSERT INTO Library VALUES (102, 'PL/SQL Fundamentals', 'Available');
COMMIT;



CREATE OR REPLACE TRIGGER trg_library_audit
  AFTER DELETE OR UPDATE ON Library
  FOR EACH ROW
DECLARE
  v_op_type VARCHAR2(10);
BEGIN
  
  IF UPDATING THEN
    v_op_type := 'UPDATE';
  ELSIF DELETING THEN
    v_op_type := 'DELETE';
  END IF;

  
  INSERT INTO Library_Audit (
    id_old,
    book_name_old,
    status_old,
    operation_type,
    operation_date
  )
  VALUES (
    :old.id,
    :old.book_name,
    :old.status,
    v_op_type,
    SYSDATE
  );
  
EXCEPTION
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Error in trg_library_audit: ' || SQLERRM);
END trg_library_audit;
/

SET SERVEROUTPUT ON;

BEGIN
  DBMS_OUTPUT.PUT_LINE('--- Updating book 101 ---');
  UPDATE Library
  SET status = 'Checked Out'
  WHERE id = 101;
  
  DBMS_OUTPUT.PUT_LINE('--- Deleting book 102 ---');
  DELETE FROM Library
  WHERE id = 102;
  
  COMMIT;
  DBMS_OUTPUT.PUT_LINE('DML complete. Check Library_Audit table.');
END;
/

SELECT * FROM Library;
SELECT * FROM Library_Audit;
